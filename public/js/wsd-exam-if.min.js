window.WSD||(window.WSD={debug:!0}),window.WSD.certificationsIF=function(){var _examTitle,_percent,_serverAnswers,_thisLevel,_userAnswers,_allExams=null,_options={},_examAnsweredCorrectly=0,_hasPassed=!1,_isRetake=!1,_isReview=!1,_thisExam=null,_emitEvent=function(name,event){_options[name];_options[name]&&_options[name](event)},_getHostnameUrl=function(){var hostnameURL=new URL(_options.endpoint);return hostnameURL.protocol+"//"+hostnameURL.hostname+":"+hostnameURL.port+"/"},_getAnswersFromServer=function(level){return _xhr("GET",_getHostnameUrl()+"external/exams/answers/"+level)},_getAnswersFromSession=function(){var storageObj=sessionStorage.getItem("wsd-answers");return storageObj?JSON.parse(storageObj):[]},_getAnswerToQuestion=function(answers,id){for(var rightAnswer=null,answerInfo=null,i=0;i<answers.length;i++){var answer=answers[i];if(answer.id===id){rightAnswer=answer.answer,answerInfo=answer.answer_info;break}}return{rightAnswer:rightAnswer,answerInfo:answerInfo}},_getQuestionsForExam=function(thisLevel){return _allExams.certificationQuestions.filter(function(entry){return entry.level===thisLevel})},_isCorrectAnswer=function(sequence,answerIndex){return _serverAnswers[sequence].answer===answerIndex?"wsd-answer-info":_getAnswersFromSession()[sequence].answer===answerIndex?"wsd-incorrect-answer":""},_playVideo=function(url){var output='<div class="wsd-video-container">',container=document.querySelector(_options.renderInto);output+='<iframe id="ytplayer" type="text/html" width="'+.8*container.clientWidth+'" height="'+.8*container.clientWidth/1.77+'" src="'+url+'" frameborder="0"></iframe>',output+='<button class="btn wsd-btn-primary" id="wsd-begin-test-button">Begin test</button>',output+="</div>",output=_renderHook("showVideo",output),document.querySelector(_options.renderInto).innerHTML=output,document.querySelector("#wsd-begin-test-button").addEventListener("click",function(event){_showExam(_thisExam)})},_processAnswers=function(level){_getAnswersFromServer(level).then(function(response){_serverAnswers=response,_userAnswers=_getAnswersFromSession(),_emitEvent("onProcessAnswers",{servernswers:_serverAnswers,userAnswer:_userAnswers}),_examAnsweredCorrectly=0;for(var i=0;i<_userAnswers.length;i++){var answer=_userAnswers[i],obj=_getAnswerToQuestion(_serverAnswers,answer.id);answer.answerInfo=obj.answerInfo,answer.isCorrect=obj.rightAnswer===answer.answer,answer.isCorrect&&_examAnsweredCorrectly++}_percent=Math.round(_examAnsweredCorrectly/_userAnswers.length*100),_hasPassed=!1,_percent>=_options.passMark&&(_hasPassed=!0),_sendResult(),_showResult()})},_renderExamList=function(){var output='<div class="wsd-page">',index=0;_allExams.certificationLevels.forEach(function(level){if(level.video){var difficulty="Hard";"Level 1"===level.name&&(difficulty="Easy"),"Level 2"===level.name&&(difficulty="Medium"),output+='<div class="wsd-exam-container" id="wec-'+index+'">',output+='<div class="wsd-exam-title">'+level.body.display_name+"</div>",output+='<div class="wsd-exam-image"><img src="'+level.image+'" /></div>',output+='<div class="wsd-exam-video-duration">Duration: '+level.video_duration+" (mins)</div>",output+='<div class="wsd-exam-description">'+level.description+"</div>",output+='<div classs="wsd-exam-difficulty">Difficulty: '+difficulty+"</div>",output+='<div><a class="wsd-begin-test" href="'+level.body.url+'">Begin test &rarr;</a></div>',output+='<input type="hidden" value="'+level.video+'" />',output+="</div>",index++}}),output+="</div>",output=_renderHook("showExamList",output),document.querySelector(_options.renderInto).innerHTML=output;for(var allTests=document.querySelectorAll(".wsd-begin-test"),i=0;i<allTests.length;i++){allTests[i].addEventListener("click",function(event){event.preventDefault()})}for(var allContainers=document.querySelectorAll(".wsd-exam-container"),i=0;i<allContainers.length;i++){allContainers[i].addEventListener("click",function(event){var href=document.querySelector("#"+this.id+" .wsd-begin-test"),exam=new URL(href);_thisExam=exam.pathname;var input=document.querySelector("#"+this.id+" input");if(!input)throw new Error("Cannot find video URL");_playVideo(input.value)})}},_renderHook=function(name,html){return _options.renderHook?_options.renderHook({name:name,html:html}):html},_saveAnswer=function(answer,sequence,id){var allAnswers=_getAnswersFromSession();allAnswers[sequence]={answer:answer,id:id},sessionStorage.setItem("wsd-answers",JSON.stringify(allAnswers))};_sendResult=function(){var results={levelName:"Level "+_thisLevel,hasPassed:_hasPassed,totalScore:_examAnsweredCorrectly,totalQuestions:_userAnswers.length,passingScore:_options.passMark};return _xhr("POST",_options.endpoint+"external/exams/results",results)};var _showAnswerGrid=function(){var output='<div class="wsd-grid-button-container">';output+="<hr />";for(var i=0;i<_userAnswers.length;i++){console.log(i,_userAnswers[i].isCorrect);_userAnswers[i].isCorrect;output+='<button class="wsd-grid-button '+(_userAnswers[i].isCorrect?"wsd-button-correct":"")+'">'+(i+1)+"&nbsp</button>"}return output+="</div>"},_showAnswerGridHook=function(){for(var gridButtons=document.querySelectorAll(".wsd-grid-button"),i=0;i<gridButtons.length;i++){gridButtons[i].addEventListener("click",function(event){event.preventDefault();var sequence=parseInt(event.target.innerHTML)-1,questions=_getQuestionsForExam(_thisLevel);_showQuestions(questions,_thisLevel,sequence)})}},_showExam=function(exam){var thisExam;exam=exam.replace("/","");for(var i=0;i<_allExams.certificationLevels.length;i++){var item=_allExams.certificationLevels[i];if(item.body.url===exam){thisExam=item;break}}_examTitle=thisExam.body.display_name,_thisLevel=parseInt(exam.toLowerCase().replace("level-","")),_emitEvent("onShowExam",{isReview:_isReview,isRetake:_isRetake,examTitle:_examTitle,level:_thisLevel});var questions=_getQuestionsForExam(_thisLevel);_showQuestions(questions,_thisLevel)},_showQuestion=function(question,sequence,questionCount){return new Promise(function(resolve,reject){_emitEvent("onShowQuestion",{sequence:sequence});var disabled=_isReview?"disabled":"",output='<div class="wsd-question-container">';output+='<div class="wsd-exam-title">'+_examTitle+"</div>",output+='<div class="wsd-question-header">Q'+(sequence+1)+".&nbsp;"+question.question+"</div>",output+='<div class="wsd-answer-container">';for(var answerIndex=0;answerIndex<question.options.length;answerIndex++){var isCorrectAnswerClass="";_isReview&&(isCorrectAnswerClass=_isCorrectAnswer(sequence,answerIndex)),output+='<div class="wsd-answer-choice-container '+isCorrectAnswerClass+'"><div><input '+disabled+' class="wsd-answer-radio" id=id_"'+answerIndex+'" type="radio" name="wsd-answer" value="'+answerIndex+'" /></div><div><label class="wsd-answer-choice" for=id_"'+answerIndex+'">'+question.options[answerIndex]+"</label></div></div>",_isReview&&(output+=_showQuestionInfo(sequence,answerIndex))}output+="</div>";var prevDisabled=0===sequence?"disabled":"",nextText=sequence+1===questionCount?"Finish":"Next";output+='<div class="wsd-question-button-container">',output+='<button type="button" class="btn wsd-btn-secondary wsd-question-prev-button" '+prevDisabled+" >Previous question</button>",output+='<button type="button" class="btn wsd-btn-primary wsd-question-next-button">'+nextText+"</button>",output+="</div>",_isReview&&(output+=_showAnswerGrid()),output+="</div>",output=_renderHook("showQuestion",output),document.querySelector(_options.renderInto).innerHTML=output,_isReview&&_showAnswerGridHook();var allAnswers=_getAnswersFromSession();if(allAnswers[sequence]){document.getElementsByName("wsd-answer")[allAnswers[sequence].answer].setAttribute("checked",!0)}document.querySelector(".wsd-question-next-button").addEventListener("click",function(event){if(event.preventDefault(),document.querySelector('input[name="wsd-answer"]:checked')){var answer=document.querySelector('input[name="wsd-answer"]:checked').value;resolve({answer:answer,direction:"next"})}}),document.querySelector(".wsd-question-prev-button").addEventListener("click",function(event){if(event.preventDefault(),document.querySelector('input[name="wsd-answer"]:checked')){var answer=document.querySelector('input[name="wsd-answer"]:checked').value;return resolve({answer:answer,direction:"prev"})}resolve({answer:null,direction:"prev"})}),_options.animateQuestions&&(document.querySelector(".wsd-question-container").style.left="-2000px",setTimeout(function(){document.querySelector(".wsd-question-container").style.left="0px"},50))})},_showQuestionInfo=function(sequence,answerIndex){var serverAnswer=(_getQuestionsForExam(_thisLevel)[sequence],_serverAnswers[sequence]);return serverAnswer.answer===answerIndex?'<div class="wsd-answer-info">'+serverAnswer.answer_info+"</div>":_getAnswersFromSession()[sequence].answer===answerIndex?'<div class="wsd-incorrect-answer"></div>':""},_showQuestions=function(questions,level,startAt){questions.length=3;var sequence=0;startAt&&(sequence=startAt);var renderQuestion=function(){return new Promise(function(resolve,reject){_showQuestion(questions[sequence],sequence,questions.length).then(function(response){if(_emitEvent("onAnswer",{response:response,sequence:sequence}),null!==response.answer&&_saveAnswer(parseInt(response.answer),sequence,questions[sequence].id),"next"===response.direction){if(++sequence===questions.length)return resolve()}else sequence--;renderQuestion().then(function(){console.log("9"),resolve()})})})};renderQuestion().then(function(){_emitEvent("onFinish",{}),_processAnswers(level)})},_showResult=function(results,answeredCorrectly){var output='<div class="wsd-result-container">';output+='<div class="wsd-result-header">Results</div>',output+='<div class="wsd-result-header-2">',output+=_hasPassed?'<div class="wsd-result-text">'+_options.successText+"</div>":'<div class="wsd-result-text">'+_options.failureText+"</div>",output+="</div>",output+="<hr />",output+='<div class="wsd-score-text">Your score was: <span class="wsd-answered-correctly">'+_examAnsweredCorrectly+'</span> / <span class="wsd-total-answers">'+_userAnswers.length+'</span> or <span class="wsd-percent">'+_percent+"%</span></div>",output+='<div class="wsd-result-review-questions">You can review your questions, or, retake the test.</div>',output+='<div class="wsd-review-button-container">',output+='<button type="button" class="btn wsd-btn-primary wsd-review-button">Review</button>',output+='<button type="button" class="btn wsd-btn-primary wsd-retake-button">Retake</button>',output+="</div>",output+="</div>",output+="</div>",output=_renderHook("showResult",output),document.querySelector(_options.renderInto).innerHTML=output,_isReview=!1,_isRetake=!1,document.querySelector(".wsd-retake-button").addEventListener("click",function(event){event.preventDefault(),sessionStorage.removeItem("wsd-answers"),_isReview=!1,_isRetake=!0,_showExam(_thisExam)}),document.querySelector(".wsd-review-button").addEventListener("click",function(event){event.preventDefault(),_isReview=!0,_showExam(_thisExam)})},_xhr=function(op,url,body){return new Promise(function(resolve,reject){var xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){4==this.readyState&&200==this.status&&resolve(JSON.parse(xhttp.responseText))},xhttp.open(op,url),xhttp.setRequestHeader("Authorization","Bearer "+_options.authToken),"POST"===op?(xhttp.setRequestHeader("Content-Type","application/json"),xhttp.send(JSON.stringify(body))):xhttp.send()})};return{viewAllExams:function(){alert("a"),_xhr("GET",_options.endpoint+"external/exams").then(function(exams){alert("a"),console.log(exams),_allExams=exams,_renderExamList()})},init:function(options){_options=options,_options.passMark=options.passMark?options.passMark:85,_options.successText=options.successText?options.successText:"Congratulations!  You have passed.",_options.failureText=options.failureText?options.failureText:"You have not passed this time."}}}(),WSD.logger=function(type,message,data){if(WSD.debug){var method="log";switch(type){case"error":case"info":case"warn":case"debug":method=type}data?console[method](message,data):console[method](message)}},function($){if(void 0===window.WSD)throw new Error("WSD namespace not defined");WSD.Main={Dom:{AuthToken:$("#authToken"),Console:$("#console"),Endpoint:$("#endpoint"),SetOptions:$("#setOptions"),BeginTest:$(".beginTest"),GetAllExams:$(".getAllExams"),ShowConsole:$("#showConsole")},_getAllExams:function(event){if(""===WSD.Main.Dom.AuthToken.val().trim())return void alert("Please supply an authentication token.");event.stopPropagation(),WSD.Main._setOptions(),WSD.certificationsIF.viewAllExams()},_eventCallback:function(name,event){var content=name+" "+JSON.stringify(event)+"\n";document.getElementById("examConsoleContent").value+=content;var console=$("#examConsoleContent");console.scrollTop(console[0].scrollHeight)},_onAnswer:function(event){WSD.Main._eventCallback("onAnswer",event)},_onFinish:function(event){WSD.Main._eventCallback("onFinish",event)},_onProcessAnswers:function(event){WSD.Main._eventCallback("onProcessAnswers",event)},_onShowExam:function(event){WSD.Main._eventCallback("onShowExam",event)},_onShowQuestion:function(event){WSD.Main._eventCallback("onShowQuestion",event)},_toggleConsole:function(){WSD.Main.Dom.Console.toggle(250)},_renderHook:function(event){return event.html},_setOptions:function(){var authToken=WSD.Main.Dom.AuthToken.val().trim();if(0===authToken.length)return void $(".noauthtoken").show();$(".noauthtoken").hide();var endpoint=WSD.Main.Dom.Endpoint.val().trim();if(0===endpoint.length)return void $(".noendpoint").show();$(".noendpoint").hide(),sessionStorage.setItem("wsd-endpoint",endpoint),sessionStorage.setItem("wsd-authToken",authToken),WSD.certificationsIF.init({endpoint:endpoint,authToken:authToken,animateQuestions:!1,eventCallback:WSD.Main._eventCallback,onAnswer:WSD.Main._onAnswer,onFinish:WSD.Main._onFinish,onProcessAnswers:WSD.Main._onProcessAnswers,onShowExam:WSD.Main._onShowExam,onShowQuestion:WSD.Main._onShowQuestion,renderHook:WSD.Main._renderHook,renderInto:"#examContainer"})},init:function(){var self=this;self.Dom.GetAllExams.on("click",self._getAllExams),self.Dom.SetOptions.on("click",self._setOptions),self.Dom.ShowConsole.on("change",self._toggleConsole),self.Dom.Endpoint.val(sessionStorage.getItem("wsd-endpoint")),self.Dom.AuthToken.val(sessionStorage.getItem("wsd-authToken")),alert("a"),WSD.logger("info","Main initialised...")}},WSD.Main.init()}(jQuery);